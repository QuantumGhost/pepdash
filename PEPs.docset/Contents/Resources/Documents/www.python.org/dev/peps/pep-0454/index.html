<!doctype html>
<!--[if lt IE 7]>   <html class="no-js ie6 lt-ie7 lt-ie8 lt-ie9">   <![endif]-->
<!--[if IE 7]>      <html class="no-js ie7 lt-ie8 lt-ie9">          <![endif]-->
<!--[if IE 8]>      <html class="no-js ie8 lt-ie9">                 <![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en" dir="ltr">  <!--<![endif]-->


<!-- Mirrored from www.python.org/dev/peps/pep-0454/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 03 Sep 2015 04:34:49 GMT -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <link rel="prefetch" href="../../../../ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">

    <meta name="application-name" content="Python.org">
    <meta name="msapplication-tooltip" content="The official home of the Python Programming Language">
    <meta name="apple-mobile-web-app-title" content="Python.org">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="HandheldFriendly" content="True">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="cleartype" content="on">
    <meta http-equiv="imagetoolbar" content="false">

    <script src="../../../static/js/libs/modernizr.js"></script>

    <link href="../../../static/stylesheets/style.css" rel="stylesheet" type="text/css" title="default" />
    <link href="../../../static/stylesheets/mq.css" rel="stylesheet" type="text/css" media="not print, braille, embossed, speech, tty" />
    

    <!--[if (lte IE 8)&(!IEMobile)]>
    <link href="/static/stylesheets/no-mq.css" rel="stylesheet" type="text/css" media="screen" />
    
    
    <![endif]-->

    
    <link rel="icon" type="image/x-icon" href="https://www.python.org/static/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../../static/apple-touch-icon-144x144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../../static/apple-touch-icon-114x114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../../static/apple-touch-icon-72x72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../../../static/apple-touch-icon-precomposed.png">
    <link rel="apple-touch-icon" href="../../../static/apple-touch-icon-precomposed.png">

    
    <meta name="msapplication-TileImage" content="/static/metro-icon-144x144-precomposed.png"><!-- white shape -->
    <meta name="msapplication-TileColor" content="#3673a5"><!-- python blue -->
    <meta name="msapplication-navbutton-color" content="#3673a5">

    <meta property="og:site_name" content="Python.org">
    <meta property="og:type" content="website">

    <title>PEP 0454 -- Add a new tracemalloc module to trace Python memory allocations | Python.org</title>
    <meta property="og:title" content="Welcome to Python.org">

    
    <meta name="description" content="The official home of the Python Programming Language">
    <meta name="og:description" content="The official home of the Python Programming Language">
    <meta name="keywords" content="Python programming language object oriented web free open source software license documentation download community">
    <meta property="og:tag" content="Python programming language object oriented web free open source software license documentation download community">
    <meta property="og:published_time" content="">
    <meta property="og:modified_time" content="">
    <meta property="og:author" content="">
    <meta property="og:section" content=""> 
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <meta property="og:video" content="">

    <link rel="author" href="https://www.python.org/static/humans.txt">

    

    
    <script type="application/ld+json">
     {
       "@context": "http://schema.org",
       "@type": "WebSite",
       "url": "https://www.python.org/",
       "potentialAction": {
         "@type": "SearchAction",
         "target": "https://www.python.org/search/?q={search_term_string}",
         "query-input": "required name=search_term_string"
       }
     }
    </script>

    
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39055973-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    
</head>

<body class="python pages pep-page">

    <div id="touchnav-wrapper">

        <div id="nojs" class="do-not-print">
            <p><strong>Notice:</strong> While Javascript is not essential for this website, your interaction with the content will be limited. Please turn Javascript on for the full experience. </p>
        </div>

        <!--[if lt IE 8]>
        <div id="oldie-warning" class="do-not-print">
            <p><strong>Notice:</strong> Your browser is <em>ancient</em> and <a href="http://www.ie6countdown.com/">Microsoft agrees</a>. <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience a better web.</p>
        </div>
        <![endif]-->

        <!-- Sister Site Links -->
        <div id="top" class="top-bar do-not-print">

            <nav class="meta-navigation container" role="navigation">

                
                <div class="skip-link screen-reader-text">
                    <a href="#content" title="Skip to content">Skip to content</a>
                </div>

                
                <a id="close-python-network" class="jump-link" href="#python-network" aria-hidden="true">
                    <span aria-hidden="true" class="icon-arrow-down"><span>&#9660;</span></span> Close
                </a>

                

<ul class="menu" role="tree">
    
    <li class="python-meta ">
        <a href="https://www.python.org/" title="The Python Programming Language" >Python</a>
    </li>
    
    <li class="psf-meta ">
        <a href="https://www.python.org/psf-landing/" title="The Python Software Foundation" >PSF</a>
    </li>
    
    <li class="docs-meta ">
        <a href="https://docs.python.org/" title="Python Documentation" >Docs</a>
    </li>
    
    <li class="pypi-meta ">
        <a href="https://pypi.python.org/" title="Python Package Index" >PyPI</a>
    </li>
    
    <li class="jobs-meta ">
        <a href="https://www.python.org/jobs/" title="Python Job Board" >Jobs</a>
    </li>
    
    <li class="shop-meta ">
        <a href="https://www.python.org/community/" title="Python Community" >Community</a>
    </li>
    
</ul>


                <a id="python-network" class="jump-link" href="#top" aria-hidden="true">
                    <span aria-hidden="true" class="icon-arrow-up"><span>&#9650;</span></span> The Python Network
                </a>

            </nav>

        </div>

        <!-- Header elements -->
        <header class="main-header" role="banner">
            <div class="container">

                <h1 class="site-headline">
                    <a href="https://www.python.org/"><img class="python-logo" src="../../../static/img/python-logo.png" alt="python&trade;"></a>
                </h1>

                <div class="options-bar do-not-print">

                    
                    <a id="site-map-link" class="jump-to-menu" href="#site-map"><span class="menu-icon">&equiv;</span> Menu</a><form class="search-the-site" action="https://www.python.org/search/" method="get">
                        <fieldset title="Search Python.org">

                            <span aria-hidden="true" class="icon-search"></span>

                            <label class="screen-reader-text" for="id-search-field">Search This Site</label>
                            <input id="id-search-field" name="q" type="search" role="textbox" class="search-field" placeholder="Search" value="" tabindex="1">

                            <button type="submit" name="submit" id="submit" class="search-button" title="Submit this Search" tabindex="3">
                                GO
                            </button>

                            
                            <!--[if IE]><input type="text" style="display: none;" disabled="disabled" size="1" tabindex="4"><![endif]-->

                        </fieldset>
                    </form><span class="breaker"></span><div class="adjust-font-size" aria-hidden="true">
                        <ul class="navigation menu" aria-label="Adjust Text Size on Page">
                            <li class="tier-1 last" aria-haspopup="true">
                                <a href="#" class="action-trigger"><strong><small>A</small> A</strong></a>
                                <ul class="subnav menu">
                                    <li class="tier-2 element-1" role="treeitem"><a class="text-shrink" title="Make Text Smaller" href="javascript:;">Smaller</a></li>
                                    <li class="tier-2 element-2" role="treeitem"><a class="text-grow" title="Make Text Larger" href="javascript:;">Larger</a></li>
                                    <li class="tier-2 element-3" role="treeitem"><a class="text-reset" title="Reset any font size changes I have made" href="javascript:;">Reset</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div><div class="winkwink-nudgenudge">
                        <ul class="navigation menu" aria-label="Social Media Navigation">
                            <li class="tier-1 last" aria-haspopup="true">
                                <a href="#" class="action-trigger">Socialize</a>
                                <ul class="subnav menu">
                                    <li class="tier-2 element-1" role="treeitem"><a href="http://plus.google.com/+Python"><span aria-hidden="true" class="icon-google-plus"></span>Google+</a></li>
                                    <li class="tier-2 element-2" role="treeitem"><a href="http://www.facebook.com/pythonlang?fref=ts"><span aria-hidden="true" class="icon-facebook"></span>Facebook</a></li>
                                    <li class="tier-2 element-3" role="treeitem"><a href="http://twitter.com/ThePSF"><span aria-hidden="true" class="icon-twitter"></span>Twitter</a></li>
                                    <li class="tier-2 element-4" role="treeitem"><a href="https://www.python.org/community/irc/"><span aria-hidden="true" class="icon-freenode"></span>Chat on IRC</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div><div class="account-signin">
                        <ul class="navigation menu" aria-label="Social Media Navigation">
                            <li class="tier-1 last" aria-haspopup="true">
                                
                                <a href="https://www.python.org/accounts/login/" title="Sign Up or Sign In to Python.org">Sign In</a>
                                <ul class="subnav menu">
                                    <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/accounts/signup/">Sign Up / Register</a></li>
                                    <li class="tier-2 element-2" role="treeitem"><a href="https://www.python.org/accounts/login/">Sign In</a></li>
                                </ul>
                                
                            </li>
                        </ul>
                    </div>

                </div><!-- end options-bar -->

                <nav id="mainnav" class="python-navigation main-navigation do-not-print" role="navigation">
                    
                        
<ul class="navigation menu" role="menubar" aria-label="Main Navigation">
  
    
    
    <li id="about" class="tier-1 element-1  " aria-haspopup="true">
        <a href="https://www.python.org/about/" title="" class="">About</a>
        
            

<ul class="subnav menu" role="menu" aria-hidden="true">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/about/apps/" title="">Applications</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="https://www.python.org/about/quotes/" title="">Quotes</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="https://www.python.org/about/gettingstarted/" title="">Getting Started</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="https://www.python.org/about/help/" title="">Help</a></li>
    
</ul>

        
    </li>
    
    
    
    <li id="downloads" class="tier-1 element-2  " aria-haspopup="true">
        <a href="https://www.python.org/downloads/" title="" class="">Downloads</a>
        
            

<ul class="subnav menu" role="menu" aria-hidden="true">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/downloads/" title="">All releases</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="https://www.python.org/downloads/source/" title="">Source code</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="https://www.python.org/downloads/windows/" title="">Windows</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="https://www.python.org/downloads/mac-osx/" title="">Mac OS X</a></li>
    
        <li class="tier-2 element-5" role="treeitem"><a href="https://www.python.org/download/other/" title="">Other Platforms</a></li>
    
        <li class="tier-2 element-6" role="treeitem"><a href="https://docs.python.org/3/license.html" title="">License</a></li>
    
        <li class="tier-2 element-7" role="treeitem"><a href="https://www.python.org/download/alternatives" title="">Alternative Implementations</a></li>
    
</ul>

        
    </li>
    
    
    
    <li id="documentation" class="tier-1 element-3  " aria-haspopup="true">
        <a href="https://www.python.org/doc/" title="" class="">Documentation</a>
        
            

<ul class="subnav menu" role="menu" aria-hidden="true">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/doc/" title="">Docs</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="https://www.python.org/doc/av" title="">Audio/Visual Talks</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="https://wiki.python.org/moin/BeginnersGuide" title="">Beginner&#39;s Guide</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="https://docs.python.org/devguide/" title="">Developer&#39;s Guide</a></li>
    
        <li class="tier-2 element-5" role="treeitem"><a href="https://docs.python.org/faq/" title="">FAQ</a></li>
    
        <li class="tier-2 element-6" role="treeitem"><a href="http://wiki.python.org/moin/Languages" title="">Non-English Docs</a></li>
    
        <li class="tier-2 element-7" role="treeitem"><a href="../index.html" title="">PEP Index</a></li>
    
        <li class="tier-2 element-8" role="treeitem"><a href="https://wiki.python.org/moin/PythonBooks" title="">Python Books</a></li>
    
</ul>

        
    </li>
    
    
    
    <li id="community" class="tier-1 element-4  " aria-haspopup="true">
        <a href="https://www.python.org/community/" title="" class="">Community</a>
        
            

<ul class="subnav menu" role="menu" aria-hidden="true">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/community/diversity/" title="">Diversity</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="https://www.python.org/community/irc/" title="">IRC</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="https://www.python.org/community/lists/" title="">Mailing Lists</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="https://www.python.org/community/workshops/" title="">Python Conferences</a></li>
    
        <li class="tier-2 element-5" role="treeitem"><a href="https://www.python.org/community/sigs/" title="">Special Interest Groups</a></li>
    
        <li class="tier-2 element-6" role="treeitem"><a href="https://wiki.python.org/moin/" title="">Python Wiki</a></li>
    
        <li class="tier-2 element-7" role="treeitem"><a href="https://www.python.org/community/logos/" title="">Python Logo</a></li>
    
        <li class="tier-2 element-8" role="treeitem"><a href="https://www.python.org/community/merchandise/" title="">Merchandise</a></li>
    
        <li class="tier-2 element-9" role="treeitem"><a href="https://www.python.org/community/awards" title="">Community Awards</a></li>
    
</ul>

        
    </li>
    
    
    
    <li id="success-stories" class="tier-1 element-5  " aria-haspopup="true">
        <a href="https://www.python.org/about/success/" title="success-stories" class="">Success Stories</a>
        
            

<ul class="subnav menu" role="menu" aria-hidden="true">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/about/success/#arts" title="">Arts</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="https://www.python.org/about/success/#business" title="">Business</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="https://www.python.org/about/success/#education" title="">Education</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="https://www.python.org/about/success/#engineering" title="">Engineering</a></li>
    
        <li class="tier-2 element-5" role="treeitem"><a href="https://www.python.org/about/success/#government" title="">Government</a></li>
    
        <li class="tier-2 element-6" role="treeitem"><a href="https://www.python.org/about/success/#scientific" title="">Scientific</a></li>
    
        <li class="tier-2 element-7" role="treeitem"><a href="https://www.python.org/about/success/#software-development" title="">Software Development</a></li>
    
</ul>

        
    </li>
    
    
    
    <li id="news" class="tier-1 element-6  " aria-haspopup="true">
        <a href="https://www.python.org/blogs/" title="News from around the Python world" class="">News</a>
        
            

<ul class="subnav menu" role="menu" aria-hidden="true">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/blogs/" title="Python Insider Blog Posts">Python News</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="http://planetpython.org/" title="Planet Python">Community News</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="http://pyfound.blogspot.com/" title="PSF Blog">PSF News</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="http://pycon.blogspot.com/" title="PyCon Blog">PyCon News</a></li>
    
</ul>

        
    </li>
    
    
    
    <li id="events" class="tier-1 element-7  " aria-haspopup="true">
        <a href="https://www.python.org/events/" title="" class="">Events</a>
        
            

<ul class="subnav menu" role="menu" aria-hidden="true">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/events/python-events/" title="">Python Events</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="https://www.python.org/events/python-user-group/" title="">User Group Events</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="https://www.python.org/events/python-events/past/" title="">Python Events Archive</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="https://www.python.org/events/python-user-group/past/" title="">User Group Events Archive</a></li>
    
        <li class="tier-2 element-5" role="treeitem"><a href="https://wiki.python.org/moin/PythonEventsCalendar#Submitting_an_Event" title="">Submit an Event</a></li>
    
</ul>

        
    </li>
    
    
    
    
  
</ul>

                    
                </nav>

                <div class="header-banner "> <!-- for optional "do-not-print" class -->
                    
                    
                </div>

                
                

             </div><!-- end .container -->
        </header>

        <div id="content" class="content-wrapper">
            <!-- Main Content Column -->
            <div class="container">

                <section class="main-content with-left-sidebar" role="main">

                    
<ul class="breadcrumbs menu">
    <li>
        <a href="https://www.python.org/" title="The Python Programming Language">Python</a><span class="prompt">&gt;&gt;&gt;</span>
    </li>
    <li>
        <a href="https://www.python.org/dev/">Python Developer's Guide</a><span class="prompt">&gt;&gt;&gt;</span>
    </li>
    <li>
        <a href="../index.html">PEP Index</a><span class="prompt">&gt;&gt;&gt;</span>
    </li>
    <li>PEP 0454 -- Add a new tracemalloc module to trace Python memory allocations</li>
</ul>


                    
<style>
   .pep-page pre {
        padding: .5em;
        background: inherit;
        border-left: 0px;
        -webkit-box-shadow: 0 0 0 0;
        -moz-box-shadow: 0 0 0 0;
        box-shadow: 0 0 0 0;
   }
</style>

    
    <article class="text">
        

        <header class="article-header">
            <h1 class="page-title">PEP 0454 -- Add a new tracemalloc module to trace Python memory allocations</h1>
        </header>

        <!--
This HTML is auto-generated.  DO NOT EDIT THIS FILE!  If you are writing a new
PEP, see http://www.python.org/dev/peps/pep-0001 for instructions and links
to templates.  DO NOT USE THIS HTML FILE AS YOUR TEMPLATE!
-->
<html>
 <body>
  <table class="rfc2822 docutils field-list" frame="void" rules="none">
   <col class="field-name">
   </col>
   <col class="field-body">
   </col>
   <tbody valign="top">
    <tr class="field">
     <th class="field-name">
      PEP:
     </th>
     <td class="field-body">
      454
     </td>
    </tr>
    <tr class="field">
     <th class="field-name">
      Title:
     </th>
     <td class="field-body">
      Add a new tracemalloc module to trace Python memory allocations
     </td>
    </tr>
    <tr class="field">
     <th class="field-name">
      Author:
     </th>
     <td class="field-body">
      Victor Stinner &lt;victor.stinner at gmail.com&gt;
     </td>
    </tr>
    <tr class="field">
     <th class="field-name">
      BDFL-Delegate:
     </th>
     <td class="field-body">
      Charles-Fran√ßois Natali &lt;
      <a class="reference external" href="mailto:cf.natali@gmail.com">
       cf.natali@gmail.com
      </a>
      &gt;
     </td>
    </tr>
    <tr class="field">
     <th class="field-name">
      Status:
     </th>
     <td class="field-body">
      Final
     </td>
    </tr>
    <tr class="field">
     <th class="field-name">
      Type:
     </th>
     <td class="field-body">
      Standards Track
     </td>
    </tr>
    <tr class="field">
     <th class="field-name">
      Created:
     </th>
     <td class="field-body">
      3-September-2013
     </td>
    </tr>
    <tr class="field">
     <th class="field-name">
      Python-Version:
     </th>
     <td class="field-body">
      3.4
     </td>
    </tr>
    <tr class="field">
     <th class="field-name">
      Resolution:
     </th>
     <td class="field-body">
      <a class="reference external" href="https://mail.python.org/pipermail/python-dev/2013-November/130491.html">
       https://mail.python.org/pipermail/python-dev/2013-November/130491.html
      </a>
     </td>
    </tr>
   </tbody>
  </table>
  <hr/>
  <div class="contents topic" id="contents">
   <p class="topic-title first">
    Contents
   </p>
   <ul class="simple">
    <li>
     <a class="reference internal" href="#abstract" id="id2">
      Abstract
     </a>
    </li>
    <li>
     <a class="reference internal" href="#rationale" id="id3">
      Rationale
     </a>
    </li>
    <li>
     <a class="reference internal" href="#proposal" id="id4">
      Proposal
     </a>
    </li>
    <li>
     <a class="reference internal" href="#api" id="id5">
      API
     </a>
     <ul>
      <li>
       <a class="reference internal" href="#functions" id="id6">
        Functions
       </a>
      </li>
      <li>
       <a class="reference internal" href="#filter" id="id7">
        Filter
       </a>
      </li>
      <li>
       <a class="reference internal" href="#frame" id="id8">
        Frame
       </a>
      </li>
      <li>
       <a class="reference internal" href="#snapshot" id="id9">
        Snapshot
       </a>
      </li>
      <li>
       <a class="reference internal" href="#statistic" id="id10">
        Statistic
       </a>
      </li>
      <li>
       <a class="reference internal" href="#statisticdiff" id="id11">
        StatisticDiff
       </a>
      </li>
      <li>
       <a class="reference internal" href="#trace" id="id12">
        Trace
       </a>
      </li>
      <li>
       <a class="reference internal" href="#traceback" id="id13">
        Traceback
       </a>
      </li>
     </ul>
    </li>
    <li>
     <a class="reference internal" href="#rejected-alternatives" id="id14">
      Rejected Alternatives
     </a>
     <ul>
      <li>
       <a class="reference internal" href="#log-calls-to-the-memory-allocator" id="id15">
        Log calls to the memory allocator
       </a>
      </li>
     </ul>
    </li>
    <li>
     <a class="reference internal" href="#prior-work" id="id16">
      Prior Work
     </a>
    </li>
    <li>
     <a class="reference internal" href="#links" id="id17">
      Links
     </a>
    </li>
    <li>
     <a class="reference internal" href="#copyright" id="id18">
      Copyright
     </a>
    </li>
   </ul>
  </div>
  <div class="section" id="abstract">
   <h1>
    <a class="toc-backref" href="#id2">
     Abstract
    </a>
   </h1>
   <p>
    This PEP proposes to add a new
    <tt class="docutils literal">
     tracemalloc
    </tt>
    module to trace memory
blocks allocated by Python.
   </p>
  </div>
  <div class="section" id="rationale">
   <h1>
    <a class="toc-backref" href="#id3">
     Rationale
    </a>
   </h1>
   <p>
    Classic generic tools like Valgrind can get the C traceback where a
memory block was allocated. Using such tools to analyze Python memory
allocations does not help because most memory blocks are allocated in
the same C function, in
    <tt class="docutils literal">
     PyMem_Malloc()
    </tt>
    for example. Moreover, Python
has an allocator for small objects called "pymalloc" which keeps free
blocks for efficiency. This is not well handled by these tools.
   </p>
   <p>
    There are debug tools dedicated to the Python language like
    <tt class="docutils literal">
     Heapy
    </tt>
    <tt class="docutils literal">
     Pympler
    </tt>
    and
    <tt class="docutils literal">
     Meliae
    </tt>
    which lists all alive objects using the
garbage collector module (functions like
    <tt class="docutils literal">
     gc.get_objects()
    </tt>
    ,
    <tt class="docutils literal">
     gc.get_referrers()
    </tt>
    and
    <tt class="docutils literal">
     gc.get_referents()
    </tt>
    ), compute their size
(ex: using
    <tt class="docutils literal">
     sys.getsizeof()
    </tt>
    ) and group objects by type. These tools
provide a better estimation of the memory usage of an application.  They
are useful when most memory leaks are instances of the same type and
this type is only instantiated in a few functions. Problems arise when
the object type is very common like
    <tt class="docutils literal">
     str
    </tt>
    or
    <tt class="docutils literal">
     tuple
    </tt>
    , and it is hard
to identify where these objects are instantiated.
   </p>
   <p>
    Finding reference cycles is also a difficult problem.  There are
different tools to draw a diagram of all references.  These tools
cannot be used on large applications with thousands of objects because
the diagram is too huge to be analyzed manually.
   </p>
  </div>
  <div class="section" id="proposal">
   <h1>
    <a class="toc-backref" href="#id4">
     Proposal
    </a>
   </h1>
   <p>
    Using the customized allocation API from
    <a class="reference external" href="../pep-0445/index.html">
     PEP 445
    </a>
    , it becomes easy to
set up a hook on Python memory allocators. A hook can inspect Python
internals to retrieve Python tracebacks. The idea of getting the current
traceback comes from the faulthandler module. The faulthandler dumps
the traceback of all Python threads on a crash, here is the idea is to
get the traceback of the current Python thread when a memory block is
allocated by Python.
   </p>
   <p>
    This PEP proposes to add a new
    <tt class="docutils literal">
     tracemalloc
    </tt>
    module, a debug tool
to trace memory blocks allocated by Python. The module provides the
following information:
   </p>
   <ul class="simple">
    <li>
     Traceback where an object was allocated
    </li>
    <li>
     Statistics on allocated memory blocks per filename and per line
number: total size, number and average size of allocated memory blocks
    </li>
    <li>
     Computed differences between two snapshots to detect memory leaks
    </li>
   </ul>
   <p>
    The API of the tracemalloc module is similar to the API of the faulthandler
module:
    <tt class="docutils literal">
     enable()
    </tt>
    /
    <tt class="docutils literal">
     start()
    </tt>
    ,
    <tt class="docutils literal">
     disable()
    </tt>
    /
    <tt class="docutils literal">
     stop()
    </tt>
    and
    <tt class="docutils literal">
     is_enabled()
    </tt>
    /
    <tt class="docutils literal">
     is_tracing()
    </tt>
    functions, an environment variable
(
    <tt class="docutils literal">
     PYTHONFAULTHANDLER
    </tt>
    and
    <tt class="docutils literal">
     PYTHONTRACEMALLOC
    </tt>
    ), and a
    <tt class="docutils literal">
     <span class="pre">
      -X
     </span>
    </tt>
    command line
option (
    <tt class="docutils literal">
     <span class="pre">
      -X
     </span>
     faulthandler
    </tt>
    and
    <tt class="docutils literal">
     <span class="pre">
      -X
     </span>
     tracemalloc
    </tt>
    ). See the
    <a class="reference external" href="http://docs.python.org/3/library/faulthandler.html">
     documentation of
the faulthandler module
    </a>
    .
   </p>
   <p>
    The idea of tracing memory allocations is not new. It was first
implemented in the PySizer project in 2005. PySizer was implemented
differently: the traceback was stored in frame objects and some Python
types were linked the trace with the name of object type. PySizer patch
on CPython adds a overhead on performances and memory footprint, even if
the PySizer was not used. tracemalloc attachs a traceback to the
underlying layer, to memory blocks, and has no overhead when the module
is not tracing memory allocations.
   </p>
   <p>
    The tracemalloc module has been written for CPython. Other
implementations of Python may not be able to provide it.
   </p>
  </div>
  <div class="section" id="api">
   <h1>
    <a class="toc-backref" href="#id5">
     API
    </a>
   </h1>
   <p>
    To trace most memory blocks allocated by Python, the module should be
started as early as possible by setting the
    <tt class="docutils literal">
     PYTHONTRACEMALLOC
    </tt>
    environment variable to
    <tt class="docutils literal">
     1
    </tt>
    , or by using
    <tt class="docutils literal">
     <span class="pre">
      -X
     </span>
     tracemalloc
    </tt>
    command
line option. The
    <tt class="docutils literal">
     tracemalloc.start()
    </tt>
    function can be called at
runtime to start tracing Python memory allocations.
   </p>
   <p>
    By default, a trace of an allocated memory block only stores the most
recent frame (1 frame). To store 25 frames at startup: set the
    <tt class="docutils literal">
     PYTHONTRACEMALLOC
    </tt>
    environment variable to
    <tt class="docutils literal">
     25
    </tt>
    , or use the
    <tt class="docutils literal">
     <span class="pre">
      -X
     </span>
     tracemalloc=25
    </tt>
    command line option. The
    <tt class="docutils literal">
     set_traceback_limit()
    </tt>
    function can be used at runtime to set the limit.
   </p>
   <div class="section" id="functions">
    <h2>
     <a class="toc-backref" href="#id6">
      Functions
     </a>
    </h2>
    <p>
     <tt class="docutils literal">
      clear_traces()
     </tt>
     function:
    </p>
    <blockquote>
     <p>
      Clear traces of memory blocks allocated by Python.
     </p>
     <p>
      See also
      <tt class="docutils literal">
       stop()
      </tt>
      .
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      get_object_traceback(obj)
     </tt>
     function:
    </p>
    <blockquote>
     <p>
      Get the traceback where the Python object
      <em>
       obj
      </em>
      was allocated.
Return a
      <tt class="docutils literal">
       Traceback
      </tt>
      instance, or
      <tt class="docutils literal">
       None
      </tt>
      if the
      <tt class="docutils literal">
       tracemalloc
      </tt>
      module is not tracing memory allocations or did not trace the
allocation of the object.
     </p>
     <p>
      See also
      <tt class="docutils literal">
       gc.get_referrers()
      </tt>
      and
      <tt class="docutils literal">
       sys.getsizeof()
      </tt>
      functions.
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      get_traceback_limit()
     </tt>
     function:
    </p>
    <blockquote>
     <p>
      Get the maximum number of frames stored in the traceback of a trace.
     </p>
     <p>
      The
      <tt class="docutils literal">
       tracemalloc
      </tt>
      module must be tracing memory allocations to get
the limit, otherwise an exception is raised.
     </p>
     <p>
      The limit is set by the
      <tt class="docutils literal">
       start()
      </tt>
      function.
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      get_traced_memory()
     </tt>
     function:
    </p>
    <blockquote>
     Get the current size and maximum size of memory blocks traced by the
     <tt class="docutils literal">
      tracemalloc
     </tt>
     module as a tuple:
     <tt class="docutils literal">
      (size: int, max_size: int)
     </tt>
     .
    </blockquote>
    <p>
     <tt class="docutils literal">
      get_tracemalloc_memory()
     </tt>
     function:
    </p>
    <blockquote>
     Get the memory usage in bytes of the
     <tt class="docutils literal">
      tracemalloc
     </tt>
     module used to
store traces of memory blocks. Return an
     <tt class="docutils literal">
      int
     </tt>
     .
    </blockquote>
    <p>
     <tt class="docutils literal">
      is_tracing()
     </tt>
     function:
    </p>
    <blockquote>
     <p>
      <tt class="docutils literal">
       True
      </tt>
      if the
      <tt class="docutils literal">
       tracemalloc
      </tt>
      module is tracing Python memory
allocations,
      <tt class="docutils literal">
       False
      </tt>
      otherwise.
     </p>
     <p>
      See also
      <tt class="docutils literal">
       start()
      </tt>
      and
      <tt class="docutils literal">
       stop()
      </tt>
      functions.
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      start(nframe: int=1)
     </tt>
     function:
    </p>
    <blockquote>
     <p>
      Start tracing Python memory allocations: install hooks on Python
memory allocators. Collected tracebacks of traces will be limited to
      <em>
       nframe
      </em>
      frames. By default, a trace of a memory block only stores
the most recent frame: the limit is
      <tt class="docutils literal">
       1
      </tt>
      .
      <em>
       nframe
      </em>
      must be greater
or equal to
      <tt class="docutils literal">
       1
      </tt>
      .
     </p>
     <p>
      Storing more than
      <tt class="docutils literal">
       1
      </tt>
      frame is only useful to compute statistics
grouped by
      <tt class="docutils literal">
       'traceback'
      </tt>
      or to compute cumulative statistics: see
the
      <tt class="docutils literal">
       Snapshot.compare_to()
      </tt>
      and
      <tt class="docutils literal">
       Snapshot.statistics()
      </tt>
      methods.
     </p>
     <p>
      Storing more frames increases the memory and CPU overhead of the
      <tt class="docutils literal">
       tracemalloc
      </tt>
      module. Use the
      <tt class="docutils literal">
       get_tracemalloc_memory()
      </tt>
      function to measure how much memory is used by the
      <tt class="docutils literal">
       tracemalloc
      </tt>
      module.
     </p>
     <p>
      The
      <tt class="docutils literal">
       PYTHONTRACEMALLOC
      </tt>
      environment variable
(
      <tt class="docutils literal">
       PYTHONTRACEMALLOC=NFRAME
      </tt>
      ) and the
      <tt class="docutils literal">
       <span class="pre">
        -X
       </span>
      </tt>
      <tt class="docutils literal">
       tracemalloc=NFRAME
      </tt>
      command line option can be used to start tracing at startup.
     </p>
     <p>
      See also
      <tt class="docutils literal">
       stop()
      </tt>
      ,
      <tt class="docutils literal">
       is_tracing()
      </tt>
      and
      <tt class="docutils literal">
       get_traceback_limit()
      </tt>
      functions.
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      stop()
     </tt>
     function:
    </p>
    <blockquote>
     <p>
      Stop tracing Python memory allocations: uninstall hooks on Python
memory allocators. Clear also traces of memory blocks allocated by
Python
     </p>
     <p>
      Call
      <tt class="docutils literal">
       take_snapshot()
      </tt>
      function to take a snapshot of traces
before clearing them.
     </p>
     <p>
      See also
      <tt class="docutils literal">
       start()
      </tt>
      and
      <tt class="docutils literal">
       is_tracing()
      </tt>
      functions.
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      take_snapshot()
     </tt>
     function:
    </p>
    <blockquote>
     <p>
      Take a snapshot of traces of memory blocks allocated by Python.
Return a new
      <tt class="docutils literal">
       Snapshot
      </tt>
      instance.
     </p>
     <p>
      The snapshot does not include memory blocks allocated before the
      <tt class="docutils literal">
       tracemalloc
      </tt>
      module started to trace memory allocations.
     </p>
     <p>
      Tracebacks of traces are limited to
      <tt class="docutils literal">
       get_traceback_limit()
      </tt>
      frames. Use the
      <em>
       nframe
      </em>
      parameter of the
      <tt class="docutils literal">
       start()
      </tt>
      function to
store more frames.
     </p>
     <p>
      The
      <tt class="docutils literal">
       tracemalloc
      </tt>
      module must be tracing memory allocations to
take a snapshot, see the the
      <tt class="docutils literal">
       start()
      </tt>
      function.
     </p>
     <p>
      See also the
      <tt class="docutils literal">
       get_object_traceback()
      </tt>
      function.
     </p>
    </blockquote>
   </div>
   <div class="section" id="filter">
    <h2>
     <a class="toc-backref" href="#id7">
      Filter
     </a>
    </h2>
    <p>
     <tt class="docutils literal">
      Filter(inclusive: bool, filename_pattern: str, lineno: int=None, all_frames: bool=False)
     </tt>
     class:
    </p>
    <blockquote>
     <p>
      Filter on traces of memory blocks.
     </p>
     <p>
      See the
      <tt class="docutils literal">
       fnmatch.fnmatch()
      </tt>
      function for the syntax of
      <em>
       filename_pattern
      </em>
      . The
      <tt class="docutils literal">
       '.pyc'
      </tt>
      and
      <tt class="docutils literal">
       '.pyo'
      </tt>
      file extensions
are replaced with
      <tt class="docutils literal">
       '.py'
      </tt>
      .
     </p>
     <p>
      Examples:
     </p>
     <ul class="simple">
      <li>
       <tt class="docutils literal">
        Filter(True, subprocess.__file__)
       </tt>
       only includes traces of the
       <tt class="docutils literal">
        subprocess
       </tt>
       module
      </li>
      <li>
       <tt class="docutils literal">
        Filter(False, tracemalloc.__file__)
       </tt>
       excludes traces of the
       <tt class="docutils literal">
        tracemalloc
       </tt>
       module
      </li>
      <li>
       <tt class="docutils literal">
        Filter(False,
        <span class="pre">
         "&lt;unknown&gt;")
        </span>
       </tt>
       excludes empty tracebacks
      </li>
     </ul>
    </blockquote>
    <p>
     <tt class="docutils literal">
      inclusive
     </tt>
     attribute:
    </p>
    <blockquote>
     <p>
      If
      <em>
       inclusive
      </em>
      is
      <tt class="docutils literal">
       True
      </tt>
      (include), only trace memory blocks
allocated in a file with a name matching
      <tt class="docutils literal">
       filename_pattern
      </tt>
      at
line number
      <tt class="docutils literal">
       lineno
      </tt>
      .
     </p>
     <p>
      If
      <em>
       inclusive
      </em>
      is
      <tt class="docutils literal">
       False
      </tt>
      (exclude), ignore memory blocks
allocated in a file with a name matching
      <tt class="docutils literal">
       filename_pattern
      </tt>
      at
line number
      <tt class="docutils literal">
       lineno
      </tt>
      .
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      lineno
     </tt>
     attribute:
    </p>
    <blockquote>
     Line number (
     <tt class="docutils literal">
      int
     </tt>
     ) of the filter. If
     <em>
      lineno
     </em>
     is
     <tt class="docutils literal">
      None
     </tt>
     , the
filter matches any line number.
    </blockquote>
    <p>
     <tt class="docutils literal">
      filename_pattern
     </tt>
     attribute:
    </p>
    <blockquote>
     Filename pattern of the filter (
     <tt class="docutils literal">
      str
     </tt>
     ).
    </blockquote>
    <p>
     <tt class="docutils literal">
      all_frames
     </tt>
     attribute:
    </p>
    <blockquote>
     <p>
      If
      <em>
       all_frames
      </em>
      is
      <tt class="docutils literal">
       True
      </tt>
      , all frames of the traceback are
checked. If
      <em>
       all_frames
      </em>
      is
      <tt class="docutils literal">
       False
      </tt>
      , only the most recent frame is
checked.
     </p>
     <p>
      This attribute is ignored if the traceback limit is less than
      <tt class="docutils literal">
       2
      </tt>
      .
See the
      <tt class="docutils literal">
       get_traceback_limit()
      </tt>
      function and
      <tt class="docutils literal">
       Snapshot.traceback_limit
      </tt>
      attribute.
     </p>
    </blockquote>
   </div>
   <div class="section" id="frame">
    <h2>
     <a class="toc-backref" href="#id8">
      Frame
     </a>
    </h2>
    <p>
     <tt class="docutils literal">
      Frame
     </tt>
     class:
    </p>
    <blockquote>
     <p>
      Frame of a traceback.
     </p>
     <p>
      The
      <tt class="docutils literal">
       Traceback
      </tt>
      class is a sequence of
      <tt class="docutils literal">
       Frame
      </tt>
      instances.
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      filename
     </tt>
     attribute:
    </p>
    <blockquote>
     Filename (
     <tt class="docutils literal">
      str
     </tt>
     ).
    </blockquote>
    <p>
     <tt class="docutils literal">
      lineno
     </tt>
     attribute:
    </p>
    <blockquote>
     Line number (
     <tt class="docutils literal">
      int
     </tt>
     ).
    </blockquote>
   </div>
   <div class="section" id="snapshot">
    <h2>
     <a class="toc-backref" href="#id9">
      Snapshot
     </a>
    </h2>
    <p>
     <tt class="docutils literal">
      Snapshot
     </tt>
     class:
    </p>
    <blockquote>
     <p>
      Snapshot of traces of memory blocks allocated by Python.
     </p>
     <p>
      The
      <tt class="docutils literal">
       take_snapshot()
      </tt>
      function creates a snapshot instance.
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      compare_to(old_snapshot: Snapshot, group_by: str, cumulative: bool=False)
     </tt>
     method:
    </p>
    <blockquote>
     <p>
      Compute the differences with an old snapshot. Get statistics as a
sorted list of
      <tt class="docutils literal">
       StatisticDiff
      </tt>
      instances grouped by
      <em>
       group_by
      </em>
      .
     </p>
     <p>
      See the
      <tt class="docutils literal">
       statistics()
      </tt>
      method for
      <em>
       group_by
      </em>
      and
      <em>
       cumulative
      </em>
      parameters.
     </p>
     <p>
      The result is sorted from the biggest to the smallest by: absolute
value of
      <tt class="docutils literal">
       StatisticDiff.size_diff
      </tt>
      ,
      <tt class="docutils literal">
       StatisticDiff.size
      </tt>
      ,
absolute value of
      <tt class="docutils literal">
       StatisticDiff.count_diff
      </tt>
      ,
      <tt class="docutils literal">
       Statistic.count
      </tt>
      and then by
      <tt class="docutils literal">
       StatisticDiff.traceback
      </tt>
      .
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      dump(filename)
     </tt>
     method:
    </p>
    <blockquote>
     <p>
      Write the snapshot into a file.
     </p>
     <p>
      Use
      <tt class="docutils literal">
       load()
      </tt>
      to reload the snapshot.
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      filter_traces(filters)
     </tt>
     method:
    </p>
    <blockquote>
     <p>
      Create a new
      <tt class="docutils literal">
       Snapshot
      </tt>
      instance with a filtered
      <tt class="docutils literal">
       traces
      </tt>
      sequence,
      <em>
       filters
      </em>
      is a list of
      <tt class="docutils literal">
       Filter
      </tt>
      instances.  If
      <em>
       filters
      </em>
      is an empty list, return a new
      <tt class="docutils literal">
       Snapshot
      </tt>
      instance with a copy of
the traces.
     </p>
     <p>
      All inclusive filters are applied at once, a trace is ignored if no
inclusive filters match it. A trace is ignored if at least one
exclusive filter matchs it.
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      load(filename)
     </tt>
     classmethod:
    </p>
    <blockquote>
     <p>
      Load a snapshot from a file.
     </p>
     <p>
      See also
      <tt class="docutils literal">
       dump()
      </tt>
      .
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      statistics(group_by: str, cumulative: bool=False)
     </tt>
     method:
    </p>
    <blockquote>
     <p>
      Get statistics as a sorted list of
      <tt class="docutils literal">
       Statistic
      </tt>
      instances grouped
by
      <em>
       group_by
      </em>
      :
     </p>
     <table border="1" class="docutils">
      <colgroup>
       <col width="47%">
       </col>
       <col width="53%">
       </col>
      </colgroup>
      <thead valign="bottom">
       <tr>
        <th class="head">
         group_by
        </th>
        <th class="head">
         description
        </th>
       </tr>
      </thead>
      <tbody valign="top">
       <tr>
        <td>
         <tt class="docutils literal">
          'filename'
         </tt>
        </td>
        <td>
         filename
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          'lineno'
         </tt>
        </td>
        <td>
         filename and line number
        </td>
       </tr>
       <tr>
        <td>
         <tt class="docutils literal">
          'traceback'
         </tt>
        </td>
        <td>
         traceback
        </td>
       </tr>
      </tbody>
     </table>
     <p>
      If
      <em>
       cumulative
      </em>
      is
      <tt class="docutils literal">
       True
      </tt>
      , cumulate size and count of memory
blocks of all frames of the traceback of a trace, not only the most
recent frame. The cumulative mode can only be used with
      <em>
       group_by
      </em>
      equals to
      <tt class="docutils literal">
       'filename'
      </tt>
      and
      <tt class="docutils literal">
       'lineno'
      </tt>
      and
      <tt class="docutils literal">
       traceback_limit
      </tt>
      greater than
      <tt class="docutils literal">
       1
      </tt>
      .
     </p>
     <p>
      The result is sorted from the biggest to the smallest by:
      <tt class="docutils literal">
       Statistic.size
      </tt>
      ,
      <tt class="docutils literal">
       Statistic.count
      </tt>
      and then by
      <tt class="docutils literal">
       Statistic.traceback
      </tt>
      .
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      traceback_limit
     </tt>
     attribute:
    </p>
    <blockquote>
     Maximum number of frames stored in the traceback of
     <tt class="docutils literal">
      traces
     </tt>
     :
result of the
     <tt class="docutils literal">
      get_traceback_limit()
     </tt>
     when the snapshot was taken.
    </blockquote>
    <p>
     <tt class="docutils literal">
      traces
     </tt>
     attribute:
    </p>
    <blockquote>
     <p>
      Traces of all memory blocks allocated by Python: sequence of
      <tt class="docutils literal">
       Trace
      </tt>
      instances.
     </p>
     <p>
      The sequence has an undefined order. Use the
      <tt class="docutils literal">
       Snapshot.statistics()
      </tt>
      method to get a sorted list of statistics.
     </p>
    </blockquote>
   </div>
   <div class="section" id="statistic">
    <h2>
     <a class="toc-backref" href="#id10">
      Statistic
     </a>
    </h2>
    <p>
     <tt class="docutils literal">
      Statistic
     </tt>
     class:
    </p>
    <blockquote>
     <p>
      Statistic on memory allocations.
     </p>
     <p>
      <tt class="docutils literal">
       Snapshot.statistics()
      </tt>
      returns a list of
      <tt class="docutils literal">
       Statistic
      </tt>
      instances.
     </p>
     <p>
      See also the
      <tt class="docutils literal">
       StatisticDiff
      </tt>
      class.
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      count
     </tt>
     attribute:
    </p>
    <blockquote>
     Number of memory blocks (
     <tt class="docutils literal">
      int
     </tt>
     ).
    </blockquote>
    <p>
     <tt class="docutils literal">
      size
     </tt>
     attribute:
    </p>
    <blockquote>
     Total size of memory blocks in bytes (
     <tt class="docutils literal">
      int
     </tt>
     ).
    </blockquote>
    <p>
     <tt class="docutils literal">
      traceback
     </tt>
     attribute:
    </p>
    <blockquote>
     Traceback where the memory block was allocated,
     <tt class="docutils literal">
      Traceback
     </tt>
     instance.
    </blockquote>
   </div>
   <div class="section" id="statisticdiff">
    <h2>
     <a class="toc-backref" href="#id11">
      StatisticDiff
     </a>
    </h2>
    <p>
     <tt class="docutils literal">
      StatisticDiff
     </tt>
     class:
    </p>
    <blockquote>
     <p>
      Statistic difference on memory allocations between an old and a new
      <tt class="docutils literal">
       Snapshot
      </tt>
      instance.
     </p>
     <p>
      <tt class="docutils literal">
       Snapshot.compare_to()
      </tt>
      returns a list of
      <tt class="docutils literal">
       StatisticDiff
      </tt>
      instances. See also the
      <tt class="docutils literal">
       Statistic
      </tt>
      class.
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      count
     </tt>
     attribute:
    </p>
    <blockquote>
     Number of memory blocks in the new snapshot (
     <tt class="docutils literal">
      int
     </tt>
     ):
     <tt class="docutils literal">
      0
     </tt>
     if the
memory blocks have been released in the new snapshot.
    </blockquote>
    <p>
     <tt class="docutils literal">
      count_diff
     </tt>
     attribute:
    </p>
    <blockquote>
     Difference of number of memory blocks between the old and the new
snapshots (
     <tt class="docutils literal">
      int
     </tt>
     ):
     <tt class="docutils literal">
      0
     </tt>
     if the memory blocks have been allocated
in the new snapshot.
    </blockquote>
    <p>
     <tt class="docutils literal">
      size
     </tt>
     attribute:
    </p>
    <blockquote>
     Total size of memory blocks in bytes in the new snapshot (
     <tt class="docutils literal">
      int
     </tt>
     ):
     <tt class="docutils literal">
      0
     </tt>
     if the memory blocks have been released in the new snapshot.
    </blockquote>
    <p>
     <tt class="docutils literal">
      size_diff
     </tt>
     attribute:
    </p>
    <blockquote>
     Difference of total size of memory blocks in bytes between the old
and the new snapshots (
     <tt class="docutils literal">
      int
     </tt>
     ):
     <tt class="docutils literal">
      0
     </tt>
     if the memory blocks have
been allocated in the new snapshot.
    </blockquote>
    <p>
     <tt class="docutils literal">
      traceback
     </tt>
     attribute:
    </p>
    <blockquote>
     Traceback where the memory blocks were allocated,
     <tt class="docutils literal">
      Traceback
     </tt>
     instance.
    </blockquote>
   </div>
   <div class="section" id="trace">
    <h2>
     <a class="toc-backref" href="#id12">
      Trace
     </a>
    </h2>
    <p>
     <tt class="docutils literal">
      Trace
     </tt>
     class:
    </p>
    <blockquote>
     <p>
      Trace of a memory block.
     </p>
     <p>
      The
      <tt class="docutils literal">
       Snapshot.traces
      </tt>
      attribute is a sequence of
      <tt class="docutils literal">
       Trace
      </tt>
      instances.
     </p>
    </blockquote>
    <p>
     <tt class="docutils literal">
      size
     </tt>
     attribute:
    </p>
    <blockquote>
     Size of the memory block in bytes (
     <tt class="docutils literal">
      int
     </tt>
     ).
    </blockquote>
    <p>
     <tt class="docutils literal">
      traceback
     </tt>
     attribute:
    </p>
    <blockquote>
     Traceback where the memory block was allocated,
     <tt class="docutils literal">
      Traceback
     </tt>
     instance.
    </blockquote>
   </div>
   <div class="section" id="traceback">
    <h2>
     <a class="toc-backref" href="#id13">
      Traceback
     </a>
    </h2>
    <p>
     <tt class="docutils literal">
      Traceback
     </tt>
     class:
    </p>
    <blockquote>
     <p>
      Sequence of
      <tt class="docutils literal">
       Frame
      </tt>
      instances sorted from the most recent frame to
the oldest frame.
     </p>
     <p>
      A traceback contains at least
      <tt class="docutils literal">
       1
      </tt>
      frame. If the
      <tt class="docutils literal">
       tracemalloc
      </tt>
      module
failed to get a frame, the filename
      <tt class="docutils literal">
       "&lt;unknown&gt;"
      </tt>
      at line number
      <tt class="docutils literal">
       0
      </tt>
      is
used.
     </p>
     <p>
      When a snapshot is taken, tracebacks of traces are limited to
      <tt class="docutils literal">
       get_traceback_limit()
      </tt>
      frames. See the
      <tt class="docutils literal">
       take_snapshot()
      </tt>
      function.
     </p>
     <p>
      The
      <tt class="docutils literal">
       Trace.traceback
      </tt>
      attribute is an instance of
      <tt class="docutils literal">
       Traceback
      </tt>
      instance.
     </p>
    </blockquote>
   </div>
  </div>
  <div class="section" id="rejected-alternatives">
   <h1>
    <a class="toc-backref" href="#id14">
     Rejected Alternatives
    </a>
   </h1>
   <div class="section" id="log-calls-to-the-memory-allocator">
    <h2>
     <a class="toc-backref" href="#id15">
      Log calls to the memory allocator
     </a>
    </h2>
    <p>
     A different approach is to log calls to
     <tt class="docutils literal">
      malloc()
     </tt>
     ,
     <tt class="docutils literal">
      realloc()
     </tt>
     and
     <tt class="docutils literal">
      free()
     </tt>
     functions. Calls can be logged into a file or send to another
computer through the network. Example of a log entry: name of the
function, size of the memory block, address of the memory block, Python
traceback where the allocation occurred, timestamp.
    </p>
    <p>
     Logs cannot be used directly, getting the current status of the memory
requires to parse previous logs. For example, it is not possible to get
directly the traceback of a Python object, like
     <tt class="docutils literal">
      get_object_traceback(obj)
     </tt>
     does with traces.
    </p>
    <p>
     Python uses objects with a very short lifetime and so makes an extensive
use of memory allocators. It has an allocator optimized for small
objects (less than 512 bytes) with a short lifetime.  For example, the
Python test suites calls
     <tt class="docutils literal">
      malloc()
     </tt>
     ,
     <tt class="docutils literal">
      realloc()
     </tt>
     or
     <tt class="docutils literal">
      free()
     </tt>
     270,000 times per second in average. If the size of log entry is 32
bytes, logging produces 8.2 MB per second or 29.0 GB per hour.
    </p>
    <p>
     The alternative was rejected because it is less efficient and has less
features. Parsing logs in a different process or a different computer is
slower than maintaining traces on allocated memory blocks in the same
process.
    </p>
   </div>
  </div>
  <div class="section" id="prior-work">
   <h1>
    <a class="toc-backref" href="#id16">
     Prior Work
    </a>
   </h1>
   <ul class="simple">
    <li>
     <a class="reference external" href="http://www.softwareverify.com/python/memory/index.html">
      Python Memory Validator
     </a>
     (2005-2013):
commercial Python memory validator developed by Software Verification.
It uses the Python Reflection API.
    </li>
    <li>
     <a class="reference external" href="http://pysizer.8325.org/">
      PySizer
     </a>
     : Google Summer of Code 2005 project by
Nick Smallbone.
    </li>
    <li>
     <a class="reference external" href="http://guppy-pe.sourceforge.net/">
      Heapy
     </a>
     (2006-2013):
part of the Guppy-PE project written by Sverker Nilsson.
    </li>
    <li>
     Draft PEP:
     <a class="reference external" href="http://svn.python.org/projects/python/branches/bcannon-sandboxing/PEP.txt">
      Support Tracking Low-Level Memory Usage in CPython
     </a>
     (Brett Canon, 2006)
    </li>
    <li>
     Muppy: project developed in 2008 by Robert Schuppenies.
    </li>
    <li>
     <a class="reference external" href="http://code.activestate.com/recipes/546530/">
      asizeof
     </a>
     :
a pure Python module to estimate the size of objects by Jean
Brouwers (2008).
    </li>
    <li>
     <a class="reference external" href="http://www.scons.org/wiki/LudwigHaehne/HeapMonitor">
      Heapmonitor
     </a>
     :
It provides facilities to size individual objects and can track all objects
of certain classes. It was developed in 2008 by Ludwig Haehne.
    </li>
    <li>
     <a class="reference external" href="http://code.google.com/p/pympler/">
      Pympler
     </a>
     (2008-2011):
project based on asizeof, muppy and HeapMonitor
    </li>
    <li>
     <a class="reference external" href="http://mg.pov.lt/objgraph/">
      objgraph
     </a>
     (2008-2012)
    </li>
    <li>
     <a class="reference external" href="https://pypi.python.org/pypi/Dozer">
      Dozer
     </a>
     : WSGI Middleware version
of the CherryPy memory leak debugger, written by Marius Gedminas (2008-2013)
    </li>
    <li>
     <a class="reference external" href="https://pypi.python.org/pypi/meliae">
      Meliae
     </a>
     :
Python Memory Usage Analyzer developed by John A Meinel since 2009
    </li>
    <li>
     <a class="reference external" href="https://fedorahosted.org/gdb-heap/">
      gdb-heap
     </a>
     : gdb script written in
Python by Dave Malcom (2010-2011) to analyze the usage of the heap memory
    </li>
    <li>
     <a class="reference external" href="https://pypi.python.org/pypi/memory_profiler">
      memory_profiler
     </a>
     :
written by Fabian Pedregosa (2011-2013)
    </li>
    <li>
     <a class="reference external" href="https://github.com/smartfile/caulk/">
      caulk
     </a>
     : written by Ben Timby in 2012
    </li>
   </ul>
   <p>
    See also
    <a class="reference external" href="http://pythonhosted.org/Pympler/related.html">
     Pympler Related Work
    </a>
    .
   </p>
  </div>
  <div class="section" id="links">
   <h1>
    <a class="toc-backref" href="#id17">
     Links
    </a>
   </h1>
   <p>
    tracemalloc:
   </p>
   <ul class="simple">
    <li>
     <a class="reference external" href="http://bugs.python.org/issue18874">
      #18874: Add a new tracemalloc module to trace Python
memory allocations
     </a>
    </li>
    <li>
     <a class="reference external" href="https://pypi.python.org/pypi/pytracemalloc">
      pytracemalloc on PyPI
     </a>
    </li>
   </ul>
  </div>
  <div class="section" id="copyright">
   <h1>
    <a class="toc-backref" href="#id18">
     Copyright
    </a>
   </h1>
   <p>
    This document has been placed in the public domain.
   </p>
   <!-- Local Variables:
mode: indented-text
indent-tabs-mode: nil
sentence-end-double-space: t
fill-column: 70
coding: utf-8
End: -->
  </div>
 </body>

<!-- Mirrored from www.python.org/dev/peps/pep-0454/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 03 Sep 2015 04:34:50 GMT -->
</html>Source: <a href="https://hg.python.org/peps/file/tip/pep-0454.txt">https://hg.python.org/peps/file/tip/pep-0454.txt</a>

    </article>


                </section>

                


<aside class="left-sidebar" role="secondary">

    






    





        <div class="twitter-widget sidebar-widget">
        <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/ThePSF" data-widget-id="434113224703610882">Tweets by @ThePSF</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>

    <div class="psf-sidebar-widget sidebar-widget">
        <h3 class="widget-title">The PSF</h3>
<p>The Python Software Foundation is the organization behind Python. Become a member of the PSF and help advance the software and our mission. </p>

    </div>

</aside>



                
                


            </div><!-- end .container -->
        </div><!-- end #content .content-wrapper -->

        <!-- Footer and social media list -->
        <footer id="site-map" class="main-footer" role="contentinfo">
            <div class="main-footer-links">
                <div class="container">

                    
                    <a id="back-to-top-1" class="jump-link" href="#python-network"><span aria-hidden="true" class="icon-arrow-up"><span>&#9650;</span></span> Back to Top</a>

                    

<ul class="sitemap navigation menu do-not-print" role="tree" id="container">
    
    <li class="tier-1 element-1">
        <a href="https://www.python.org/about/" >About</a>
        
            

<ul class="subnav menu">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/about/apps/" title="">Applications</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="https://www.python.org/about/quotes/" title="">Quotes</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="https://www.python.org/about/gettingstarted/" title="">Getting Started</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="https://www.python.org/about/help/" title="">Help</a></li>
    
</ul>

        
    </li>
    
    <li class="tier-1 element-2">
        <a href="https://www.python.org/downloads/" >Downloads</a>
        
            

<ul class="subnav menu">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/downloads/" title="">All releases</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="https://www.python.org/downloads/source/" title="">Source code</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="https://www.python.org/downloads/windows/" title="">Windows</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="https://www.python.org/downloads/mac-osx/" title="">Mac OS X</a></li>
    
        <li class="tier-2 element-5" role="treeitem"><a href="https://www.python.org/download/other/" title="">Other Platforms</a></li>
    
        <li class="tier-2 element-6" role="treeitem"><a href="https://docs.python.org/3/license.html" title="">License</a></li>
    
        <li class="tier-2 element-7" role="treeitem"><a href="https://www.python.org/download/alternatives" title="">Alternative Implementations</a></li>
    
</ul>

        
    </li>
    
    <li class="tier-1 element-3">
        <a href="https://www.python.org/doc/" >Documentation</a>
        
            

<ul class="subnav menu">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/doc/" title="">Docs</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="https://www.python.org/doc/av" title="">Audio/Visual Talks</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="https://wiki.python.org/moin/BeginnersGuide" title="">Beginner&#39;s Guide</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="https://docs.python.org/devguide/" title="">Developer&#39;s Guide</a></li>
    
        <li class="tier-2 element-5" role="treeitem"><a href="https://docs.python.org/faq/" title="">FAQ</a></li>
    
        <li class="tier-2 element-6" role="treeitem"><a href="http://wiki.python.org/moin/Languages" title="">Non-English Docs</a></li>
    
        <li class="tier-2 element-7" role="treeitem"><a href="../index.html" title="">PEP Index</a></li>
    
        <li class="tier-2 element-8" role="treeitem"><a href="https://wiki.python.org/moin/PythonBooks" title="">Python Books</a></li>
    
</ul>

        
    </li>
    
    <li class="tier-1 element-4">
        <a href="https://www.python.org/community/" >Community</a>
        
            

<ul class="subnav menu">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/community/diversity/" title="">Diversity</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="https://www.python.org/community/irc/" title="">IRC</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="https://www.python.org/community/lists/" title="">Mailing Lists</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="https://www.python.org/community/workshops/" title="">Python Conferences</a></li>
    
        <li class="tier-2 element-5" role="treeitem"><a href="https://www.python.org/community/sigs/" title="">Special Interest Groups</a></li>
    
        <li class="tier-2 element-6" role="treeitem"><a href="https://wiki.python.org/moin/" title="">Python Wiki</a></li>
    
        <li class="tier-2 element-7" role="treeitem"><a href="https://www.python.org/community/logos/" title="">Python Logo</a></li>
    
        <li class="tier-2 element-8" role="treeitem"><a href="https://www.python.org/community/merchandise/" title="">Merchandise</a></li>
    
        <li class="tier-2 element-9" role="treeitem"><a href="https://www.python.org/community/awards" title="">Community Awards</a></li>
    
</ul>

        
    </li>
    
    <li class="tier-1 element-5">
        <a href="https://www.python.org/about/success/" title="success-stories">Success Stories</a>
        
            

<ul class="subnav menu">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/about/success/#arts" title="">Arts</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="https://www.python.org/about/success/#business" title="">Business</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="https://www.python.org/about/success/#education" title="">Education</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="https://www.python.org/about/success/#engineering" title="">Engineering</a></li>
    
        <li class="tier-2 element-5" role="treeitem"><a href="https://www.python.org/about/success/#government" title="">Government</a></li>
    
        <li class="tier-2 element-6" role="treeitem"><a href="https://www.python.org/about/success/#scientific" title="">Scientific</a></li>
    
        <li class="tier-2 element-7" role="treeitem"><a href="https://www.python.org/about/success/#software-development" title="">Software Development</a></li>
    
</ul>

        
    </li>
    
    <li class="tier-1 element-6">
        <a href="https://www.python.org/blogs/" title="News from around the Python world">News</a>
        
            

<ul class="subnav menu">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/blogs/" title="Python Insider Blog Posts">Python News</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="http://planetpython.org/" title="Planet Python">Community News</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="http://pyfound.blogspot.com/" title="PSF Blog">PSF News</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="http://pycon.blogspot.com/" title="PyCon Blog">PyCon News</a></li>
    
</ul>

        
    </li>
    
    <li class="tier-1 element-7">
        <a href="https://www.python.org/events/" >Events</a>
        
            

<ul class="subnav menu">
    
        <li class="tier-2 element-1" role="treeitem"><a href="https://www.python.org/events/python-events/" title="">Python Events</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="https://www.python.org/events/python-user-group/" title="">User Group Events</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="https://www.python.org/events/python-events/past/" title="">Python Events Archive</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="https://www.python.org/events/python-user-group/past/" title="">User Group Events Archive</a></li>
    
        <li class="tier-2 element-5" role="treeitem"><a href="https://wiki.python.org/moin/PythonEventsCalendar#Submitting_an_Event" title="">Submit an Event</a></li>
    
</ul>

        
    </li>
    
    <li class="tier-1 element-8">
        <a href="https://www.python.org/dev/" >Contributing</a>
        
            

<ul class="subnav menu">
    
        <li class="tier-2 element-1" role="treeitem"><a href="http://docs.python.org/devguide/" title="">Developer&#39;s Guide</a></li>
    
        <li class="tier-2 element-2" role="treeitem"><a href="http://bugs.python.org/" title="">Issue Tracker</a></li>
    
        <li class="tier-2 element-3" role="treeitem"><a href="https://mail.python.org/mailman/listinfo/python-dev" title="">python-dev list</a></li>
    
        <li class="tier-2 element-4" role="treeitem"><a href="http://pythonmentors.com/" title="">Core Mentorship</a></li>
    
</ul>

        
    </li>
    
</ul>


                    <a id="back-to-top-2" class="jump-link" href="#python-network"><span aria-hidden="true" class="icon-arrow-up"><span>&#9650;</span></span> Back to Top</a>
                    

                </div><!-- end .container -->
            </div> <!-- end .main-footer-links -->

            <div class="site-base">
                <div class="container">
                    
                    <ul class="footer-links navigation menu do-not-print" role="tree">
                        <li class="tier-1 element-1"><a href="https://www.python.org/about/help/">Help &amp; <span class="say-no-more">General</span> Contact</a></li>
                        <li class="tier-1 element-2"><a href="https://www.python.org/community/diversity/">Diversity <span class="say-no-more">Initiatives</span></a></li>
                        <li class="tier-1 element-3"><a href="https://github.com/python/pythondotorg/issues">Submit Website Bug</a></li>
                        <!--<li class="tier-1 element-3"><a href="#"><span class="say-no-more">Website</span> Colophon</a></li>-->
                    </ul>

                    <div class="copyright">
                        <p><small>
                            <span class="pre">Copyright &copy;2001-2015.</span>
                            &nbsp;<span class="pre"><a href="https://www.python.org/psf-landing/">Python Software Foundation</a></span>
                            &nbsp;<span class="pre"><a href="https://www.python.org/about/legal/">Legal Statements</a></span>
                            &nbsp;<span class="pre"><a href="https://www.python.org/privacy/">Privacy Policy</a></span>
                        </small></p>
                    </div>

                </div><!-- end .container -->
            </div><!-- end .site-base -->

        </footer>

    </div><!-- end #touchnav-wrapper -->

    
    <script src="../../../../ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../../static/js/libs/jquery-1.8.2.min.js"><\/script>')</script>

    <script src="../../../static/js/libs/masonry.pkgd.min.js"></script>

    <script type="text/javascript" src="../../../static/js/main-min.js" charset="utf-8"></script>
    

    <!--[if lte IE 7]>
    <script type="text/javascript" src="/static/js/plugins/IE8-min.js" charset="utf-8"></script>
    
    
    <![endif]-->

    <!--[if lte IE 8]>
    <script type="text/javascript" src="/static/js/plugins/getComputedStyle-min.js" charset="utf-8"></script>
    
    
    <![endif]-->

    

    
    

</body>
</html>
